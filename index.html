<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gia Sư AI Tiếng Trung</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      /* GLOBAL STYLES & TYPOGRAPHY */
      :root {
        --primary-color: #28a745; /* Bootstrap Green */
        --primary-light: #5cb85c;
        --primary-dark: #1e7e34;
        --secondary-color: #007bff; /* Bootstrap Blue */
        --background-light: #f8f9fa;
        --text-dark: #343a40;
        --text-light: #6c757d;
        --card-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        --card-hover-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }

      body {
        background-color: var(--background-light);
        font-family: "Open Sans", sans-serif;
        color: var(--text-dark);
        line-height: 1.6;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Poppins", sans-serif;
        font-weight: 700;
        color: var(--text-dark);
      }

      /* NAVBAR */
      .navbar {
        background-color: var(--primary-color) !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .navbar-brand,
      .nav-link {
        color: white !important;
        font-weight: 600;
      }
      .navbar-brand {
        font-size: 1.5rem;
      }
      .nav-link:hover {
        color: rgba(255, 255, 255, 0.8) !important;
      }

      /* HERO SECTION */
      .hero-section {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-light) 100%
        );
        color: white;
        padding: 80px 0;
        text-align: center;
        margin-bottom: 50px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
      }
      .hero-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("https://www.transparenttextures.com/patterns/clean-textile.png"); /* Light subtle pattern */
        opacity: 0.1;
        z-index: 0;
      }
      .hero-section .container {
        position: relative;
        z-index: 1;
      }
      .hero-section h1 {
        font-size: 4rem;
        margin-bottom: 20px;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        color: white; /* Đảm bảo màu trắng */
      }
      .hero-section p {
        font-size: 1.3rem;
        max-width: 800px;
        margin: 0 auto 30px auto;
        opacity: 0.9;
      }
      .hero-section .btn-primary {
        background-color: white;
        color: var(--primary-color);
        border: none;
        padding: 12px 30px;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }
      .hero-section .btn-primary:hover {
        background-color: #f0f0f0;
        color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      }

      /* TOPIC CARDS GRID */
      .topic-section-title {
        color: var(--primary-color);
        font-size: 2.5rem;
        margin-bottom: 40px;
      }

      .topic-card {
        border: none;
        border-radius: 15px;
        box-shadow: var(--card-shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        overflow: hidden;
        height: 100%;
        background-color: white;
        display: flex;
        flex-direction: column; /* To ensure body takes height */
      }
      .topic-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--card-hover-shadow);
      }
      .topic-card .card-body {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 30px;
        flex-grow: 1; /* Allows body to expand */
      }
      .topic-card .card-icon {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 25px;
        transition: color 0.3s ease;
      }
      .topic-card:hover .card-icon {
        color: var(--primary-dark);
      }

      .topic-card .card-title {
        font-size: 1.8rem;
        color: var(--text-dark);
        margin-bottom: 12px;
        font-weight: 600;
      }
      .topic-card .card-text {
        color: var(--text-light);
        font-size: 1.05rem;
        line-height: 1.5;
      }

      /* CHAT MODAL STYLES */
      .chat-modal .modal-content {
        border-radius: 15px;
        overflow: hidden; /* Ensure content respects border-radius */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      .chat-modal .modal-header {
        background: linear-gradient(
          90deg,
          var(--primary-color) 0%,
          var(--primary-light) 100%
        );
        color: white;
        border-bottom: none;
        padding: 15px 20px;
      }
      .chat-modal .modal-title {
        font-weight: 600;
        font-family: "Poppins", sans-serif;
        font-size: 1.4rem;
      }
      .chat-modal .btn-close {
        filter: invert(100%); /* White close button */
        opacity: 0.8;
        transition: opacity 0.3s ease;
      }
      .chat-modal .btn-close:hover {
        opacity: 1;
      }

      .chat-modal-body {
        height: 450px; /* Adjusted height for more content */
        display: flex;
        flex-direction: column;
        padding: 0;
        background-color: #fcfcfc;
      }
      .chat-messages {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column; /* Ensure messages are stacked vertically */
        background-color: #e6e6e6; /* Light gray background for messages area */
      }
      /* Custom scrollbar */
      .chat-messages::-webkit-scrollbar {
        width: 8px;
      }
      .chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .chat-messages::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 4px;
      }
      .chat-messages::-webkit-scrollbar-thumb:hover {
        background: var(--primary-color);
      }

      .message-wrapper {
        display: flex;
        width: 100%;
        margin-bottom: 10px;
      }
      .message-wrapper.user-msg {
        justify-content: flex-end;
      }
      .message-wrapper.ai-msg {
        justify-content: flex-start;
      }

      .message-bubble {
        max-width: 80%;
        padding: 10px 15px;
        border-radius: 20px;
        line-height: 1.4;
        word-wrap: break-word;
        font-size: 0.95rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .message-bubble.user {
        background-color: #dcf8c6; /* Light green */
        color: var(--text-dark);
        border-bottom-right-radius: 5px; /* Softer corner */
      }
      .message-bubble.ai {
        background-color: #ffffff; /* White background for AI */
        color: var(--text-dark);
        border-bottom-left-radius: 5px; /* Softer corner */
      }
      .message-bubble.system-info {
        align-self: center;
        background-color: #ffecc6; /* Light orange for system messages */
        color: #7a5200;
        font-size: 0.85em;
        border-radius: 10px;
        text-align: center;
        margin: 5px auto;
        padding: 8px 12px;
        box-shadow: none;
      }

      .chat-input-area {
        display: flex;
        padding: 15px;
        border-top: 1px solid #e9ecef;
        background-color: #fff;
        flex-shrink: 0;
      }
      .chat-input {
        flex-grow: 1;
        border-radius: 25px; /* More rounded */
        padding: 10px 18px;
        border: 1px solid #ced4da;
        margin-right: 12px;
        font-size: 1rem;
      }
      .chat-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
      }
      .send-button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .send-button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-1px);
      }

      /* FOOTER */
      .footer {
        background-color: var(--text-dark);
        color: white;
        padding: 30px 0;
        margin-top: 50px;
        font-size: 0.9rem;
        text-align: center;
      }
      .footer p {
        margin-bottom: 0;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg shadow-sm fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-robot me-2"></i>Gia Sư AI Tiếng Trung
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"
                >Trang Chủ</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Về Chúng Tôi</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Liên Hệ</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link btn btn-outline-light ms-2 px-3 py-1 rounded-pill"
                href="#"
                >Đăng Nhập</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="hero-section">
      <div class="container">
        <h1>Chào Mừng Đến Với Học Viện Gia Sư AI Tiếng Trung</h1>
        <p class="lead">
          Chọn gia sư AI chuyên biệt để bắt đầu hành trình chinh phục tiếng
          Trung của bạn. Mỗi gia sư có một lĩnh vực chuyên môn riêng, sẵn sàng
          hỗ trợ bạn 24/7!
        </p>
        <a href="#topic-selection-section" class="btn btn-primary btn-lg"
          >Khám phá ngay</a
        >
      </div>
    </div>

    <div class="container mt-5" id="topic-selection-section">
      <h2 class="text-center topic-section-title mb-5">
        Chọn Gia Sư AI Của Bạn
      </h2>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Gia sư Ngữ pháp Nâng cao"
            data-topic-internal-name="advanced_grammar"
          >
            <div class="card-body">
              <i class="fas fa-book-reader card-icon"></i>
              <h5 class="card-title">Ngữ pháp Nâng cao</h5>
              <p class="card-text">
                Chuyên sâu về cấu trúc câu phức tạp, thành ngữ, và các dạng ngữ
                pháp khó trong tiếng Trung.
              </p>
            </div>
          </div>
        </div>

        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Gia sư Luyện đọc hiểu"
            data-topic-internal-name="reading_comprehension"
          >
            <div class="card-body">
              <i class="fas fa-lightbulb card-icon"></i>
              <h5 class="card-title">Luyện đọc hiểu</h5>
              <p class="card-text">
                Giúp bạn cải thiện tốc độ và khả năng nắm bắt nội dung qua các
                bài đọc, từ cơ bản đến chuyên ngành.
              </p>
            </div>
          </div>
        </div>

        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Gia sư Hội thoại Cơ bản"
            data-topic-internal-name="basic_conversation"
          >
            <div class="card-body">
              <i class="fas fa-comments card-icon"></i>
              <h5 class="card-title">Hội thoại Cơ bản</h5>
              <p class="card-text">
                Thực hành giao tiếp hàng ngày, phát âm, và xây dựng từ vựng cho
                người mới bắt đầu.
              </p>
            </div>
          </div>
        </div>

        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Gia sư Luyện thi HSK"
            data-topic-internal-name="hsk_preparation"
          >
            <div class="card-body">
              <i class="fas fa-graduation-cap card-icon"></i>
              <h5 class="card-title">Luyện thi HSK</h5>
              <p class="card-text">
                Cung cấp kiến thức và chiến lược ôn thi HSK từ cấp độ 1 đến cấp
                độ 6, giúp bạn đạt điểm cao.
              </p>
            </div>
          </div>
        </div>

        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Trợ lý Viết luận"
            data-topic-internal-name="writing_assistant"
          >
            <div class="card-body">
              <i class="fas fa-pencil-alt card-icon"></i>
              <h5 class="card-title">Trợ lý Viết luận</h5>
              <p class="card-text">
                Hỗ trợ bạn trong việc viết các đoạn văn, bài luận, hoặc email
                bằng tiếng Trung, từ cấu trúc đến từ ngữ.
              </p>
            </div>
          </div>
        </div>

        <div class="col">
          <div
            class="card topic-card"
            data-bs-toggle="modal"
            data-bs-target="#chatModal"
            data-topic-name="Chuyên gia Văn hóa"
            data-topic-internal-name="culture_and_customs"
          >
            <div class="card-body">
              <i class="fas fa-globe-asia card-icon"></i>
              <h5 class="card-title">Chuyên gia Văn hóa</h5>
              <p class="card-text">
                Tìm hiểu sâu hơn về văn hóa, phong tục, lịch sử và xã hội Trung
                Quốc để nâng cao hiểu biết.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 Gia Sư AI Tiếng Trung. Mọi quyền được bảo lưu.</p>
      </div>
    </footer>

    <div
      class="modal fade chat-modal"
      id="chatModal"
      tabindex="-1"
      aria-labelledby="chatModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="chatModalLabel"></h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body chat-modal-body">
            <div class="chat-messages" id="chatMessagesModal"></div>
            <div class="chat-input-area">
              <input
                type="text"
                class="form-control chat-input"
                id="messageInputModal"
                placeholder="Gõ tin nhắn của bạn..."
              />
              <button
                type="button"
                class="btn send-button"
                id="sendMessageButtonModal"
              >
                Gửi
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const chatModal = document.getElementById("chatModal");
        const chatModalLabel = document.getElementById("chatModalLabel");
        const chatMessagesModal = document.getElementById("chatMessagesModal");
        const messageInputModal = document.getElementById("messageInputModal");
        const sendMessageButtonModal = document.getElementById(
          "sendMessageButtonModal"
        );
        const topicCards = document.querySelectorAll(".topic-card");

        let currentTopicInternalName = ""; // Biến để lưu topicInternalName của card được click
        let currentSessionId = null; // Biến để lưu sessionId của phiên chat hiện tại

        // Mảng mô phỏng lịch sử chat (trong thực tế sẽ tải từ backend)
        let chatHistory = []; // This will be your chat messages array

        // Function to add messages to the chat display
        function addMessageToChat(role, text) {
          const messageWrapper = document.createElement("div");
          messageWrapper.className = `message-wrapper ${role}-msg`; // For alignment

          const messageDiv = document.createElement("div");
          messageDiv.className = `message-bubble ${role}`;
          messageDiv.textContent = text;

          messageWrapper.appendChild(messageDiv);
          chatMessagesModal.appendChild(messageWrapper);
          chatMessagesModal.scrollTop = chatMessagesModal.scrollHeight; // Scroll to bottom
        }

        // Reset chat when modal closes
        chatModal.addEventListener("hidden.bs.modal", () => {
          chatMessagesModal.innerHTML = ""; // Clear messages
          messageInputModal.value = ""; // Clear input
          currentTopicInternalName = ""; // Reset topic for next open
          currentSessionId = null; // Reset sessionId on close (or manage as needed)
          chatHistory = []; // Clear local history
        });

        // When modal shows
        chatModal.addEventListener("show.bs.modal", (event) => {
          const button = event.relatedTarget; // The button/card that was clicked
          const topicName = button.getAttribute("data-topic-name");
          const topicInternalName = button.getAttribute(
            "data-topic-internal-name"
          );

          chatModalLabel.textContent = topicName; // Set modal title
          currentTopicInternalName = topicInternalName; // Store topic internal name

          // --- LOGIC TO LOAD HISTORY OR START NEW SESSION ---
          // In your Vue app, this is where you'd check localStorage for a saved sessionId
          // related to this user and this specific topicInternalName.
          // If found: fetch('/api/chat/history/' + existingSessionId)
          // If not: currentSessionId = null; display initial welcome message

          // For this pure HTML example, we'll always start a "new" session for simplicity
          currentSessionId = null; // Reset sessionId to simulate new session
          chatHistory = []; // Clear dummy history

          addMessageToChat(
            "ai",
            `Chào bạn! Tôi là ${topicName}. Hãy bắt đầu học tập nhé!`
          );
        });

        // Function to send message (simulated)
        function sendMessage() {
          const messageText = messageInputModal.value.trim();
          if (!messageText) return;

          addMessageToChat("user", messageText);
          messageInputModal.value = ""; // Clear input

          // --- YOUR BACKEND API CALL WOULD GO HERE ---
          // This is where you would call your POST /api/chat endpoint
          // with payload: { message: messageText, sessionId: currentSessionId, topicInternalName: currentTopicInternalName }
          // On successful response from backend:
          // 1. Update currentSessionId = response.data.sessionId (if it's a new session ID)
          // 2. Add AI response: addMessageToChat('ai', response.data.reply)

          // SIMULATE AI RESPONSE:
          setTimeout(() => {
            const aiResponse = `Gia sư ${chatModalLabel.textContent} đã nhận được tin nhắn: "${messageText}". Tôi sẽ phản hồi sớm!`;
            addMessageToChat("ai", aiResponse);
          }, 1000);
        }

        // Event Listeners for chat modal
        sendMessageButtonModal.addEventListener("click", sendMessage);
        messageInputModal.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            sendMessage();
          }
        });
      });
    </script>
  </body>
</html>
